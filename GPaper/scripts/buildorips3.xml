<?xml version="1.0" encoding="UTF-8"?>
<project name="orips3web" basedir=".">
	<import file="${basedir}/common.xml"></import>
	<target name="initialorips3">
		<!-- <delete file="${deploy.dir}/orips3.war"/>-->
		
		<delete failonerror="false" dir="${build.orips3.home}" />
		<mkdir dir="${build.orips3.home}/WEB-INF/classes" />
		<mkdir dir="${deploy.dir}/${orips3.home}"/>
		<copy todir="${build.orips3.home}">
			<fileset dir="${webroot.home}">
				<include name="**/*" />
			</fileset>
		</copy>
		<copy todir="${build.orips3.home}/WEB-INF/lib">
			<fileset dir="${lib.home}">
				<include name="**/*.jar" />
				<exclude name="servlet-api.jar"/>
			</fileset>
		</copy>
		
	</target>
	<target name="compileorips3" depends="initialorips3">
		<javac srcdir="${src.home}" destdir="${build.orips3.home}/WEB-INF/classes" includeantruntime="false">
			<compilerarg line="-encoding UTF-8" />
			<classpath refid="compile.path">
			</classpath>
		</javac>
		<copy todir="${build.orips3.home}/WEB-INF/classes">
			<fileset dir="${src.home}">
				<include name="**/*.xml" />
				<include name="**/*.properties" />
			</fileset>
		</copy>
	</target>
	<target name="copyorips3" depends="compileorips3">
		<copy todir="${deploy.dir}/${orips3.home}">
			<fileset dir="${build.orips3.home}">
				<include name="**/*" />
				<exclude name="classes/test/**/*" />
				<exclude name="classes/edu/sjtu/erplab/orips/sessionbeans/**/*"/>
			</fileset>
		</copy>
	</target>
	<target name="copywebroot">
		<copy todir="${deploy.dir}/${orips3.home}">
			<fileset dir="${webroot.home}">
					<include name="**/*" />
			</fileset>
			<!--
			<fileset dir="${build.orips3.home}">
				<include name="**/*.js"/>
				<include name="**/*.xml"/>
				<include name="**/*.html"/>
				<include name="**/*.htm"/>
				<include name="**/*.png"/>
				<include name="**/*.gif"/>
				<include name="**/*.jpg"/>
			</fileset>-->
		</copy>
	</target>
	<target name="packuporips3" depends="compileorips3">
		<jar destfile="${build.orips3.home}/orips3.war">
			<fileset dir="${build.orips3.home}">
				<include name="**/*" />
				<exclude name="classes/test/**/*" />
				<exclude name="classes/edu/sjtu/erplab/orips/sessionbeans/**/*"/>
			</fileset>
		</jar>
	</target>
	<target name="deployorips3" depends="packuporips3">
		<copy todir="${env.JBOSS_HOME}/bin">
			<fileset dir="${configfiles.home}">
				<include name="run.conf" />
				<include name="run.bat" />
				<include name="run.conf.bat" />
			</fileset>
		</copy>
		<copy todir="${targetdeploydir}/lib">
			<fileset dir="${lib.home}">
				<include name="mysql-connector-java-5.1.7-bin.jar" />
				<include name="bsh.jar" />
			</fileset>
		</copy>
		
		<copy todir="${targetdeploydir}/conf">
			<fileset dir="${configfiles.home}">
				<include name="jboss-log4j.xml" />
			</fileset>
		</copy>
		<!--<copy todir="${deploy.dir}/">
			<fileset dir="${build.orips3.home}">
				<include name="orips3.war" />
			</fileset>
		</copy> -->
		
	</target>
</project>